---
title: "11.CQRS"
subtitle: "CQRS"
permalink: /notes/ddd-start/ch11
date: 2021-05-17 11:50
categories:
  - DDD START
tags:
  - java
last_modified_at: 2021-05-17 11:50
---
## 단일 모델의 단점
시스템의 상태를 변경할 때와 조회할 때 단일 도메인 모델을 사용하기 때문에 상태 변화에는 적합하지만, 여러 애그리거트에서 데이터를 가져와 조회하는 기능에는 구현을 복잡하게 만든다.

⇒ 상태 변경을 위한 모델과 조회를 위한 모델을 분리

## CQRS
**Command Query Responsibility Segregation의 약자로 상태를 변경하는 명령(Command)을 위한 모델과 상태를 제공하는 조회(Query)를 위한 모델을 분리하는 패턴이다.**  
![image11-1.png](/assets/images/posts/ddd-start/image11-1.png)

- 복잡한 도메인에 적합하다. 
도메인이 복잡할수록 명령기능과 조회기능이 다루는 데이터 범위에 차이가 발생하는데, 이 두 기능을 단일 모델로 처리할 경우 조회기능 구현이 복잡해진다.
- 모델에 맞는 구현기술을 선택이 가능하다.
    ![image11-2.png](/assets/images/posts/ddd-start/image11-2.png)  
    ![image11-3.png](/assets/images/posts/ddd-start/image11-3.png)

### 웹과 CQRS
일반적인 웹 서비스는 상태를 변경하는 요청보다 상태를 조회하는 요청이 많다. 그렇기 때문에 조회 성능은 중요하고 다양한 기법을 사용한다.

### CQRS 장단점

#### 장점
- **명령 모델을 구현할 때 도메인 자체에 집중 할 수 있다.**
⇒ 조회 관련 로직이 없기 때문에 복잡도를 낮춰준다.
- **조회 성능 향상**

#### 단점
- **구현해야 할 코드 증가**
- **보다 많은 구현기술이 필요.** 
명령 모델과 조회 모델을 다른 기술을 사용해서 구현하기 때문이다. 경우에 따라 각기 다른 저장소를 사용하거나, 동기화를 위해 메시징 시스템을 도입해야할 수 도 있다.

> **도메인이 복잡하지 않는데 CQRS를 도입하면 비용만 높아지고, 이점이 없다. 반대로 도메인이 복잡하고 트래픽이 높은 서비스라면 CQRS 도입을 고려해 보자.**