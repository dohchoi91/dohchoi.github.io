---
title: "02.아키텍처 개요"
subtitle: "아키텍처 개요"
permalink: /notes/ddd-start/ch02
author_profile: true
date: 2021-04-05 13:50
categories:
  - DDD START
tags:
  - java
last_modified_at: 2021-04-05 13:50
---

## 네 개의 영역

아키텍처를 설계할 때 출현하는 전형적인 영역이 `표현`, `응용`, `도메인`, `인프라스트럭처` 의 네 영역이다.

- **표현 영역**
사용자의 요청을 해석해서 응용 서비스에 전달하고 응용 서비스의 실행 결과를 사용자가 이해할 수 있는 형식으로 반환해서 응답한다.
- **응용 영역**
도메인 모델을 이용해서 사용자에게 제공할 기능을 구현한다. 실제 도메인 로직 구현은 도메인 모델에게 위함한다.
- **도메인 영역**
도메인 모델을 구현한다.
- **인프라스트럭처**
RDBMS 연동을 처리하고, 메시징 큐에 메시지를 전송하거나 수신하는 기능을 구현 하는 등 구현 기술에 대한 것을 다룬다. 논리적인 개념을 표현하기보다는 실제 구현을 다룬다.

## 계층 구조 아키텍처

- 네 개의 영역을 구성할 때 많이 사용된다.
- 계층 구조는 그 특성상 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않는다.
- 계층 구조 아키텍쳐를 사용 시 도메인과 응용계층은 룰엔진과 DB연동 등을 위해 인프라스트럭처 계층에 종속되는 부분이 발생한다. ⇒ 테스트와 기능확장이 어려워 진다.

## DIP(Dependency Inversion Principle)

- 의존 역전 원칙
- 고수준 모듈이 제대로 동작하려면 저수준 모듈을 사용해야한다. 그렇게 될 경우 테스트와 기능확장이 어려워 진다. 이러한 문제를 해결하기 위해 **저수준 모듈이 고수준 모듈에 의존하도록 바꾸기 위해 추상화한 인터페이스를 사용한다.**
- 하위 기능을 추상화한 인터페이스는 반드시 고수준 모듈 관점에서 도출한다.

## 도메인 영역의 주요 구성 요소

- **엔티티**
고유의 식별자를 갖는 객체로 자신의 라이프 사이클을 갖는다. 주문, 회원, 상품과 같이 도메인의 고유한 개념을 표현한다. 도메인 모델의 데이터를 포함하며 해당 데이터와 관련된 기능을 함께 제공한다.
- **밸류**
고유의 식별자를 갖지 않는 객체로 주로 개념적으로 하나인 도메인 객체의 속성을 표현할 때 사용된다.
- **애그리거트** 
관련된 엔티티와 밸류 객체를 하나로 묶은 것이다. 예를 들어 주문과 관련된 Order 엔티티, OrderLine 밸류, Orderer 밸류 객체를 '주문' 애그리거트로 묶을 수 있다.
- **리포지터리**
도메인 모델의 영속성을 처리한다. 예를 들어 DBMS 테이블에서 엔티티 객체를 로딩하거나 저장하는 기능을 제공한다.
- **도메인 서비스**
특정 엔티티에 속하지 않은 도메인 도직을 제공한다.

### 엔티티와 밸류

- 실제 도메인모델의 엔티티와 DB 관계형 모델의 엔티티는 같은 것이 아니다.
가장 큰 차이점은 도메인 모델은 데이터와 함께 도메인 기능을 제공한다는 점이다.
- RDBMS와 같은 관계형 DB는 밸류 타입을 제대로 표현하기가 힘들다.

### 애그리거트

- 관련 객체를 하나로 묶은 군집.
- 도메인 모델이 커지면서 많은 엔티티와 밸류는 모델을 복잡하게 한다. 도메인 모델에서 전체 구조를 이해하는데 도움이 되게 한다.
- 군집에 속한객체들을 관리하는 루트 엔티티를 갖는다.

### 리포지터리

- 도메인 객체를 지속적으로 사용하려면 물리적인 저장소에 도메인 객체를 보관해야 한다. 이를 위한 도메인 모델을 뜻한다.
- 애그리거트 단위로 도메인 객체를 저장하고 조회하는 기능을 정의한다.

## 요청 처리 흐름

사용자 입자에서 봤을 때 웹 애플리케이션이나 데스크톱 애플리케이션과 같은 소프트웨어는 기능을 제공한다. 사용자가 애플리케이션에 기능 실행을 요청하면 그 요청을 처음 받는 영역은 표현 영역이다. 표현 영역은 사용자가 전송한 데이터 형식이 올바른지 검사하고 문제가 없다면 데이터를 이용해서 응용 서비스에 기능 실행을 위임한다. 응용 서비스는 도메인 모델을 이용해서 기능을 구현한다.

## 인프라스트럭처 개요

인프라스트럭처는 표현, 응용, 도메인 영역을 지원한다. 도메인 객체의 영속성 처리, 트랜잭션, SMTP 클라이언트, REST 클라이언트 등 다른 영역에서 필요로 하는 프레임워크, 구현 기술, 보조 기능을 지원한다.

## 모듈구성

아키텍쳐의 각 영역은 별도 패키지에 위치한다. 패키지 구성 규칙에 한 개의 정답만 존재하는 것은 아니지만, 영역별로 모듈이 위치할 패키지를 구성 할 수 있다. 모듈 구조를 얼마나 세분화해야 하는지에 대해 정해진 규칙은 없다. 단지, 한 패키지에 너무 많은 타입이 몰려서 코드를 찾을 때 불편한 정도만 아니면 된다. 저자의 경우 한 패키지에 가능하면 10개 미만으로 타입 개수를 유지하려고 노력한다.